/*!
 * pixi-compressed-textures - v1.1.1
 * Compiled Wed, 11 Jan 2017 03:28:32 UTC
 *
 * pixi-compressed-textures is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r;r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(r.pixiCompressedTextures||(r.pixiCompressedTextures={})).min=e()}}(function(){return function e(r,t,a){function o(s,i){if(!t[s]){if(!r[s]){var u="function"==typeof require&&require;if(!i&&u)return u(s,!0);if(n)return n(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var c=t[s]={exports:{}};r[s][0].call(c.exports,function(e){var t=r[s][1][e];return o(t?t:e)},c,c.exports,e,r,t,a)}return t[s].exports}for(var n="function"==typeof require&&require,s=0;s<a.length;s++)o(a[s]);return o}({1:[function(e,r,t){function a(e,r,t,o,n,s,i){a.prototype.init.apply(this,arguments)}function o(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}function s(e,r,t){switch(e){case i:case c:case F:return(r+3>>2)*(t+3>>2)*8;case u:case d:case p:case f:return(r+3>>2)*(t+3>>2)*16;case M:case X:return Math.floor((Math.max(r,8)*Math.max(t,8)*4+7)/8);case L:case D:return Math.floor((Math.max(r,16)*Math.max(t,8)*2+7)/8);default:return 0}}r.exports=a,a.prototype.init=function(e,r,t,a,o,n,s){this.src=e,this.width=a,this.height=o,this.data=r,this.type=t,this.levels=n,this.internalFormat=s,this.isCompressedImage=!0;var i=this.complete;return this.complete=!!r,!i&&this.complete&&this.onload&&this.onload({target:this}),this},a.prototype.dispose=function(){this.data=null},a.prototype.generateWebGLTexture=function(e,r){if(null===this.data)throw"Trying to create a second (or more) webgl texture from the same CompressedImage : "+this.src;for(var t=this.width,a=this.height,o=this.levels,n=0,i=0;i<this.levels;++i){var u=s(this.internalFormat,t,a),d=new Uint8Array(this.data.buffer,this.data.byteOffset+n,u);e.compressedTexImage2D(e.TEXTURE_2D,i,this.internalFormat,t,a,0,d),t>>=1,t<1&&(t=1),a>>=1,a<1&&(a=1),n+=u}o>1?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),r||(this.data=null)},a.loadFromArrayBuffer=function(e,r){return new a(r).loadFromArrayBuffer(e)},a.prototype.loadFromArrayBuffer=function(e){var r=new Uint8Array(e,0,3);if(r[0]=="DDS".charCodeAt(0)&&r[1]=="DDS".charCodeAt(1)&&r[2]=="DDS".charCodeAt(2))return this._loadDDS(e);if(r[0]=="PVR".charCodeAt(0)&&r[1]=="PVR".charCodeAt(1)&&r[2]=="PVR".charCodeAt(2))return this._loadPVR(e);throw"Compressed texture format is not recognized: "+src},a.prototype._loadDDS=function(e){var r=new Int32Array(e,0,x);if(r[T]!=l)throw"Invalid magic number in DDS header";if(!r[_]&m)throw"Unsupported format, must contain a FourCC code";var t,a=r[y];switch(a){case P:t=i;break;case b:t=u;break;case R:t=d;break;case A:t=c;break;case U:t=p;break;case w:t=f;break;default:throw"Unsupported FourCC code: "+n(a)}var o=1;r[E]&h&&(o=Math.max(1,r[v]));var s=r[I],M=r[C],L=r[g]+4,X=new Uint8Array(e,L);return this.init(this.src,X,"DDS",s,M,o,t)},a.prototype._loadPVR=function(e){var r=new Int32Array(e,0,j);if(r[q]!=Y)throw"Invalid magic number in PVR header";var t,a=r[H];switch(a){case G:t=L;break;case S:t=D;break;case k:t=M;break;case N:t=X;break;case B:t=F;break;case O:t=i;break;case W:t=u;break;case V:t=d;break;default:throw"Unsupported PVR format: "+a}var o=r[K],n=r[z],s=r[Z],c=r[J]+52,p=new Uint8Array(e,c);return this.init(this.src,p,"PVR",o,n,s,t)};var i=33776,u=33778,d=33779,c=35986,p=35987,f=34798,l=542327876,h=131072,m=4,x=31,T=0,g=1,E=2,C=3,I=4,v=7,_=20,y=21,P=o("DXT1"),b=o("DXT3"),R=o("DXT5"),A=o("ATC "),U=o("ATCA"),w=o("ATCI"),M=35840,L=35841,X=35842,D=35843,F=36196,G=0,S=1,k=2,N=3,B=6,O=7,W=9,V=5,j=13,Y=55727696,q=0,H=2,z=6,K=7,Z=11,J=12},{}],2:[function(e,r,t){function a(e){n.call(this,e)}var o=PIXI,n=(e("./CompressedImage"),o.WebGLManager);a.prototype=Object.create(n.prototype),a.prototype.constructor=a,r.exports=a,o.WebGLRenderer.registerPlugin("compressedTextureManager",a),a.prototype.getSupportedExtensions=function(){function e(e,r){var t=["","WEBKIT_","MOZ_"],a=null;for(var o in t)if(a=e.getExtension(t[o]+r))break;return a}var r=this.renderer.gl;return{dxt:e(r,"WEBGL_compressed_texture_s3tc"),pvrtc:e(r,"WEBGL_compressed_texture_pvrtc"),atc:e(r,"WEBGL_compressed_texture_atc")}}},{"./CompressedImage":1}],3:[function(e,r,t){var a=e("./CompressedImage"),o=PIXI.glCore.GLTexture,n={uploadNotCompressed:o.prototype.upload,isCompressed:!1,upload:function(e){if(!(e instanceof a))return this.uploadNotCompressed(e);this.bind();var r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.isCompressed=!0,e.generateWebGLTexture(r,!0)},enableMipmap:function(){if(!this.isCompressed){var e=this.gl;this.bind(),this.mipmap=!0,e.generateMipmap(e.TEXTURE_2D)}}};r.exports=n},{"./CompressedImage":1}],4:[function(e,r,t){function a(r){r=r||[];var t=e("./imageParser")();return function(e,a){var o=e.metadata.choice;if(!o)return a();var n=e.url;if(!e._defaultUrlChoice){e._defaultUrlChoice=n;var s=n.lastIndexOf(".");if(!(s>=0))return a();e._baseUrl=n.substring(0,s)}for(var i=o.length-1;i>=0;i--){n=e._baseUrl+o[i];for(var u=0;u<r.length;u++)if(o[i]===r[u])return e.url=n,e.loadType=e._determineLoadType(),t(e,a)}return t(e,a)}}r.exports=a},{"./imageParser":6}],5:[function(e,r,t){function a(e){return function(e,r){if(e.texture&&e._defaultUrlChoice&&e._defaultUrl!=e.url){var t=e.texture,a=t.baseTexture;delete n.BaseTextureCache[a.imageUrl],delete n.TextureCache[a.imageUrl],a.imageUrl=e._defaultUrlChoice,o.utils.BaseTextureCache[a.imageUrl]=a,o.utils.TextureCache[a.imageUrl]=t}r()}}var o=PIXI,n=o.utils;e("./CompressedImage");r.exports=a},{"./CompressedImage":1}],6:[function(e,r,t){function a(){return function(e,r){if(e.url.indexOf(".dds")!=-1||e.url.indexOf(".pvr")!=-1||e.url.indexOf(".etc1")!=-1){var t=e.compressedImage||new n(e.url);if(e.data)throw"compressedImageParser middleware must be specified in loader.before() and must have zero resource.data";e.isCompressedImage=!0,e.data=t,e.onComplete.add(function(){e.type=s.TYPE.IMAGE,t.loadFromArrayBuffer(e.data),e.data=t})}r()}}var o=PIXI,n=(o.utils,e("./CompressedImage")),s=o.loaders.Resource;s.setExtensionXhrType("dds",s.XHR_RESPONSE_TYPE.BUFFER),s.setExtensionXhrType("pvr",s.XHR_RESPONSE_TYPE.BUFFER),s.setExtensionXhrType("etc1",s.XHR_RESPONSE_TYPE.BUFFER),r.exports=a},{"./CompressedImage":1}],7:[function(e,r,t){(function(t){var a={CompressedTextureManager:e("./CompressedTextureManager"),imageParser:e("./imageParser"),extensionChooser:e("./extensionChooser"),extensionFixer:e("./extensionFixer"),GLTextureMixin:e("./GLTextureMixin"),detectExtensions:function(e,r){var t=[];if(e instanceof PIXI.WebGLRenderer){var a=e.plugins.compressedTextureManager.getSupportedExtensions();a.dxt&&t.push(".dds"),a.pvrtc&&t.push(".pvr"),a.atc&&t.push(".atc")}else e instanceof PIXI.CanvasRenderer;r=r||e.resolution;for(var o="@"+r+"x",n=t.slice(0);n.length>0;)t.push(o+n.pop());return t.push(o+".png"),t.push(o+".jpg"),t.push(o+".json"),t.push(o+".atlas"),t}};Object.assign(PIXI.glCore.GLTexture.prototype,a.GLTextureMixin),PIXI.loaders.Loader.addPixiMiddleware(a.extensionFixer),PIXI.loader.use(a.extensionFixer()),r.exports=t.PIXI.compressedTextures=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./CompressedTextureManager":2,"./GLTextureMixin":3,"./extensionChooser":4,"./extensionFixer":5,"./imageParser":6}]},{},[7])(7)});
//# sourceMappingURL=pixi-compressed-textures.min.js.map
